(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{"Pc/x":function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var i=n("VrFO"),r=n.n(i),a=n("Y9Ll"),o=n.n(a),u=(n("849X"),n("TJCb"),n("7x/C"),n("JtPf"),n("KqXw"),n("LJOr"),n("yiKp")),c=n.n(u),s=n("KEM+"),l=n.n(s),p=(n("IAdD"),n("0zG9"),n("yH/f"),n("5Yy7")),f=n.n(p),h=n("2VqO"),d=n.n(h),y=n("mAxt"),v=n.n(y),g=(n("2G9S"),n("CEs6")),m=function(e){f()(n,e);var t=d()(n);function n(e,i,a){var o;return r()(this,n),(o=t.call(this,"".concat(n.displayName,": ").concat(e," HTTP-").concat(i," message: ").concat(a))).url=e,o.status=i,o}return o()(n)}(v()(Error));l()(m,"displayName","ProxseeApiError");var b,_,P=n("epkG"),k=n("SrIh"),S=n("RqPI"),A=0,T=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;r()(this,e),l()(this,"reportSpaceFor",{SelfHarm:function(e){return t._reportSpace(c()({abuse_type:R.SelfHarm},e))},Violence:function(e){return t._reportSpace(c()({abuse_type:R.Violence},e))},SexualContent:function(e){return t._reportSpace(c()({abuse_type:R.SexualContent},e))},ChildSafety:function(e){return t._reportSpace(c()({abuse_type:R.ChildSafety},e))},PrivateInformation:function(e){return t._reportSpace(c()({abuse_type:R.PrivateInformation},e))},AbusiveBehavior:function(e){return t._reportSpace(c()({abuse_type:R.AbusiveBehavior},e))}});var i=n.httpConfig;this.client=new P.a(c()(c()({},H),i)),this._authToken=void 0,this._authPromise=null}return o()(e,[{key:"init",value:function(e){_=e}},{key:"initialized",value:function(){return!!_}},{key:"isLoggedIn",value:function(){return!!this._authToken}},{key:"isTwitterAuthenticated",value:function(){if(!this.initialized())return!1;var e=_.store.getState();return Object(S.o)(e)}},{key:"authToken",value:function(){return this._authToken}},{key:"dispatch",value:function(e){return this.initialized()?this.client.dispatch(e).then(g.a):Promise.reject(new Error("[ProxseeApi] config not initialized"))}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.params,r=Object.assign(x(),n.headers),a=JSON.stringify(c()(c()({},t),{},{cookie:this._authToken})),o="Twitter"===this._authUserType?"twitter/".concat(e):e;return this.dispatch({method:"POST",path:"/api/v2/".concat(o),headers:r,params:i,data:a})}},{key:"login",value:function(){var e=this;return this._authPromise?this._authPromise:this.initialized()?this.isTwitterAuthenticated()?this.isLoggedIn()?Promise.resolve():(this._authPromise=_.api.Auth.authenticatePeriscope().then((function(t){return e.loginTwitterToken(t.token)})).then((function(t){if(!t)throw new Error("[ProxseeApi] invalid loginTwitterToken response");e._authToken=t.cookie,e._authUserType=t.type})).catch((function(e){var t={err:e};Object(k.a)("[ProxseeApi] failed to login",{extra:t})})).then((function(){e._authPromise=null})),this._authPromise):Promise.resolve():Promise.reject(new Error("[ProxseeApi] config not initialized"))}},{key:"loginTwitterToken",value:function(e){var t={jwt:e,vendor_id:I,create_user:!1,direct:!0};return this.post("loginTwitterToken",t)}},{key:"publicPath",value:function(e){return this.isLoggedIn()?e:"".concat(e,"Public")}},{key:"accessChat",value:function(e){var t=this;return this.login().then((function(){return t.post(t.publicPath("accessChat"),{chat_token:e})}))}},{key:"getChatHistory",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.login().then((function(){var i=n.params,r=Object.assign(x(),n.headers),a=JSON.stringify({access_token:e.access_token,cursor:e.cursor,limit:1e3,since:null,quick_get:!0});return t.dispatch({method:"POST",host:e.host,path:e.path,headers:r,params:i,data:a})}))}},{key:"createClip",value:function(e){var t=this;return this.login().then((function(){return t.post("createClip",e).catch((function(e){Object(k.a)("[ProxseeApi] failed to create clip",{extra:{err:e}})}))}))}},{key:"getClip",value:function(e){var t=this;return this.login().then((function(){return t.post("getClip",{clip_id:e}).catch((function(e){Object(k.a)("[ProxseeApi] failed to get clip",{extra:{err:e}})}))}))}},{key:"_reportSpace",value:function(e){var t=this;return this.login().then((function(){return t.post("markAbuse",e).catch((function(e){Object(k.a)("[ProxseeApi] failed to report space",{extra:{err:e}})}))}))}}]),e}(),C="X-Idempotence",w="X-Periscope-User-Agent",E="X-Attempt",O=(b={},l()(b,w,"Twitter/m5"),l()(b,E,1),b);function x(){var e,t=Date.now();return A=t<=A?A+1:t,Object.assign({},O,(e={},l()(e,C,A),l()(e,"content-type","application/json"),e))}var I="m5-proxsee-login-a2011357b73e",j={},H={host:"https://proxsee.pscp.tv",errorFilter:function(e,t){return t(e).then((function(t){return t.status&&((n=t.status)<200||n>399)?Promise.reject(function(e,t){var n=e.uri,i=t.status,r=Object(g.a)(t);return new m(n,i,r.msg)}(e,t)):t;var n}))}};var N,R=Object.freeze({SelfHarm:"SELF_HARM",Violence:"VIOLENCE",SexualContent:"SEXUAL_CONTENT",ChildSafety:"CSE",PrivateInformation:"PRIVATE_INFO",AbusiveBehavior:"HARASSMENT"}),L=new T,z=n("G6rE"),F=new Error("[AudioModule] config not initialized"),M=new(function(){function e(){r()(this,e),this.proxsee=L}return o()(e,[{key:"init",value:function(e){N=e,L.init(N)}},{key:"initialized",value:function(){return!!N}},{key:"loggedInUser",value:function(){if(this.initialized()){var e=N.store.getState();return z.e.selectLoggedInUser(e)}}},{key:"audioSpace",value:function(e){return N?N.api.AudioSpaces.byId(e):Promise.reject(F)}},{key:"subscribeToScheduledSpace",value:function(e){return N?N.api.AudioSpaces.subscribeToScheduledSpaceById(e):Promise.reject(F)}},{key:"unsubscribeFromScheduledSpace",value:function(e){return N?N.api.AudioSpaces.unsubscribeFromScheduledSpaceById(e):Promise.reject(F)}},{key:"searchAudioSpace",value:function(e,t){return N?N.api.AudioSpaces.search(e,t):Promise.reject(F)}}]),e}())},u2Vg:function(e,t,n){"use strict";n.r(t),n.d(t,"__DANGEROUS_IMPORT_VIDEOPLAYER_BASE__",(function(){return C})),n.d(t,"__DANGEROUS_IMPORT__",(function(){return w}));var i=n("yiKp"),r=n.n(i),a=n("ddV6"),o=n.n(a),u=(n("z84I"),n("ERkP")),c=n.n(u),s=n("v6aA"),l=n("rxPX"),p=function(){return function(e,t,n){return n.api.getHttpClient()}},f=Object(l.a)().propsFromActions((function(){return{getTwitterAuthedHttpClient:p}})).withAnalytics(),h=n("Pc/x"),d=n("gOg7");var y=n("epkG"),v=n("88qn"),g=n("fs1G"),m=n("mf9H"),b=n("lklz"),_=n("MWbm"),P=n("HT/6"),k=n("Zl35"),S=n("rHpw");function A(e){var t=c.a.useContext(s.a).featureSwitches,n=e.acquisitionParams,i=e.broadcastId,a=e.canAutoplay,u=e.isLive,l=e.media,p=e.mediaKey,f=e.onEnded,y=e.onPlayerApi,_=e.onPlayerState,k=e.requestedTimecode,S=c.a.useState(null),A=o()(S,2),C=A[0],w=A[1],x=c.a.useRef({playbackCoordinationEmitter:null,previousPlayerState:null}),I=l||i&&p;if(c.a.useEffect((function(){null===C&&I&&Object(v.a)({showControls:!1,source:{}},t).then((function(e){return w((function(){return e}))}))}),[C,I,t]),c.a.useEffect((function(){return function(){var e=x.current.playbackCoordinationEmitter;e&&e.unregister()}}),[]),null===C||!I)return null;var j={analytics:function(e,t){var n=e.analytics.contextualScribeNamespace,i={scribeContext:r()({},n),enableShortFormCompleteLogging:t.isTrue("responsive_web_video_pcomplete_enabled"),periscopeAuthToken:h.a.proxsee.authToken()},a={log:function(t){var n=t.category,i=t.data,a=t.namespace;null!=a&&a.action&&e.analytics.scribe(r()(r()({},a),{},{data:r()(r()({},i),{},{_category_:n})}))}};return new d.a(a,{log:function(){}},e.getTwitterAuthedHttpClient(),i)}(e,t),basePlayerClass:C,httpClient:O,onApiReady:function(t){var n;t.play(),"function"==typeof y&&y(t);var r=null==l||null===(n=l.video_info)||void 0===n?void 0:n.duration_millis;"number"==typeof r&&"number"==typeof k&&t.scrubToFraction(k/r);var o=e.disablePlaybackCoordination?g.a:function(){return t.pause()},c=Boolean(u&&i&&p)?P.a.SPACE:P.a.NORMAL;x.current.playbackCoordinationEmitter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i={onAutoPlayRequest:function(){},onPauseRequest:e,canAutoplay:n,isLooping:!1,playbackPriority:t};return m.b.register(i)}(o,c,a)},onStateUpdate:function(e,t){"function"==typeof _&&_(e,t),function(e){var t=E(e);e.isPlaying&&t&&t.durationMs===t.currentTimeMs&&"function"==typeof f&&(f(),x.current.playbackCoordinationEmitter&&x.current.playbackCoordinationEmitter.signalPlaybackFinish())}(e),function(e){var t=x.current,n=t.playbackCoordinationEmitter,i=t.previousPlayerState,r=null===i,a=null==i?void 0:i.isPlaying,o=e.isPlaying,u=!r&&a&&!o;!r&&a||!o?u&&n&&n.signalPause():n&&n.signalPlay()}(e),x.current.previousPlayerState=e},twitterAuthedHttpClient:e.getTwitterAuthedHttpClient()};if(i&&p){var H=r()(r()({},j),{},{configType:"static",contentId:p,contentType:"broadcast",variants:[],videoId:b.b.forAudioSpace(i,p,u,n)});return c.a.createElement(T,{key:i,playerConfig:H})}if(l){var N=r()(r()({},j),{},{configType:"static",contentId:l.id_str,loop:!1,contentType:"media_entity",durationMs:l.video_info.duration_millis,variants:l.video_info.variants.map((function(e){e.bitrate;return{type:e.content_type,src:e.url}}))});return c.a.createElement(T,{key:l.id_str,playerConfig:N})}return null}function T(e){var t=e.playerConfig;return c.a.createElement(_.a,{style:x.displayNone},c.a.createElement(k.b,t))}var C=A,w=f(A),E=function(e){return e&&e.tracks[e.currentTrackId]},O=new y.a({}),x=S.a.create((function(e){return{displayNone:{display:"none"}}}))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web-legacy/loader.AudioOnlyVideoPlayer.2a0e1a47.js.map